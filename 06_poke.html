<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>📱포켓몬 도감📱</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Jua&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Jua", sans-serif;
        background: linear-gradient(to right, #ff8c8c, #ffc8c8);
      }
      .card-back {
        background-size: cover;
        background-position: center;
      }
      .stat-bar-fill {
        transition: width 0.5s ease-in-out;
      }
    </style>
  </head>

  <body class="flex items-center justify-center min-h-screen p-4">
    <div
      class="w-full max-w-sm bg-white/50 backdrop-blur-sm rounded-3xl shadow-2xl overflow-hidden transition-all duration-500"
      id="pokedexCard"
    >
      <div class="p-6">
        <h1 class="text-4xl font-bold text-center text-gray-800 mb-2">
          📱포켓몬 도감📱
        </h1>
        <div class="flex gap-2">
          <input
            id="pokeId"
            type="number"
            min="1"
            placeholder="포켓몬 ID를 입력..."
            class="w-full bg-white/70 text-gray-800 placeholder-gray-500 text-center text-lg rounded-xl p-2 border-2 border-transparent focus:outline-none focus:border-pink-400 transition"
          />
          <button
            id="pokeBtn"
            class="w-24 bg-pink-500 hover:bg-pink-600 text-white font-bold text-lg py-2 px-4 rounded-xl transition-transform duration-200 transform hover:scale-105"
          >
            검색
          </button>
        </div>
      </div>

      <div id="pokeBox" class="p-6 pt-0 min-h-[450px]">
        <!-- 포켓몬 정보가 여기에 표시됩니다 -->
      </div>
    </div>

    <script>
      const typeColors = {
        normal: "#A8A77A",
        fire: "#EE8130",
        water: "#6390F0",
        electric: "#F7D02C",
        grass: "#7AC74C",
        ice: "#96D9D6",
        fighting: "#C22E28",
        poison: "#A33EA1",
        ground: "#E2BF65",
        flying: "#A98FF3",
        psychic: "#F95587",
        bug: "#A6B91A",
        rock: "#B6A136",
        ghost: "#735797",
        dragon: "#6F35FC",
        dark: "#705746",
        steel: "#B7B7CE",
        fairy: "#D685AD",
      };
      const statNames = {
        hp: "HP",
        attack: "공격",
        defense: "방어",
        "special-attack": "특공",
        "special-defense": "특방",
        speed: "스피드",
      };
      const romanToNumber = {
        i: 1,
        ii: 2,
        iii: 3,
        iv: 4,
        v: 5,
        vi: 6,
        vii: 7,
        viii: 8,
        ix: 9,
        x: 10,
      };

      const pokeIdInput = document.getElementById("pokeId");
      const pokeBtn = document.getElementById("pokeBtn");
      const pokeBox = document.getElementById("pokeBox");

      async function getPokemon(id) {
        if (!id) {
          pokeBox.innerHTML = `<div class="text-center text-gray-600 mt-10"><p class="text-2xl">ID를 입력하고<br/>포켓몬을 찾아보세요!</p></div>`;
          return;
        }

        pokeBox.innerHTML = `<div class="flex justify-center items-center h-full mt-20"><div class="animate-spin rounded-full h-24 w-24 border-t-4 border-b-4 border-pink-500"></div></div>`;

        try {
          const [pokemonRes, speciesRes] = await Promise.all([
            fetch(`https://pokeapi.co/api/v2/pokemon/${id}`),
            fetch(`https://pokeapi.co/api/v2/pokemon-species/${id}`),
          ]);

          if (!pokemonRes.ok) throw new Error("Pokemon not found!");
          if (!speciesRes.ok) throw new Error("Pokemon species not found!");

          const data = await pokemonRes.json();
          const data2 = await speciesRes.json();

          // 세대 한글화
          const generationRoman = data2.generation.name.replace(
            "generation-",
            ""
          );
          const generation = romanToNumber[generationRoman]
            ? `${romanToNumber[generationRoman]}세대`
            : generationRoman;

          const pokeData = {
            id: data.id,
            engName: data.name,
            koName:
              data2.names.find((v) => v.language.name === "ko")?.name ||
              data.name,
            shape:
              data.sprites.other["official-artwork"].front_default ||
              data.sprites.front_default,
            sound: data.cries?.latest,
            generation, // 세대 추가
            description:
              data2.flavor_text_entries
                .find((entry) => entry.language.name === "ko")
                ?.flavor_text.replace(/[\n\f]/g, " ") || "설명이 없습니다.",
            types: data.types.map((t) => t.type.name),
            stats: data.stats,
          };

          renderPoke(pokeData);
          localStorage.setItem("recent", JSON.stringify(pokeData));
        } catch (error) {
          console.error("Error:", error);
          pokeBox.innerHTML = `<div class="text-center text-red-500 mt-10"><p class="text-2xl">포켓몬을 찾을 수 없습니다.<br/>ID를 다시 확인해주세요!</p></div>`;
        }
      }

      function renderPoke({
        id,
        koName,
        engName,
        shape,
        sound,
        generation,
        description,
        types,
        stats,
      }) {
        const primaryType = types[0];
        const cardColor = typeColors[primaryType] || "#A8A77A";
        document.getElementById(
          "pokedexCard"
        ).style.boxShadow = `0 25px 50px -12px ${cardColor}`;

        pokeBox.innerHTML = `
          <div class="card-back rounded-2xl p-5 -mt-2" style="background-color: ${cardColor}">
            <div class="flex justify-between items-start mb-2">
              <h2 class="text-3xl font-bold text-white">${koName}</h2>
              <span class="text-xl font-bold text-white/80">#${String(
                id
              ).padStart(4, "0")}</span>
            </div>
            <p class="text-center text-white/90 font-semibold mb-2">${generation} 포켓몬</p>
            <div class="w-full h-48 bg-white/30 rounded-xl flex items-center justify-center mb-3">
                <img src="${shape}" alt="${koName}" class="w-40 h-40 object-contain drop-shadow-2xl">
            </div>
            <div class="flex justify-center gap-2 mb-3">
              ${types
                .map(
                  (type) =>
                    `<span class="text-white text-sm font-bold px-3 py-1 rounded-full" style="background-color: ${
                      typeColors[type] || "#A8A77A"
                    }; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">${type}</span>`
                )
                .join("")}
            </div>
          </div>
          <div class="px-5 py-3">
            <p class="text-center text-gray-700 mb-3 h-16 overflow-y-auto">설명: ${description}</p>
            <div class="space-y-2 mb-3">
              ${stats
                .map(
                  (stat) => `
                <div class="flex items-center gap-2">
                  <span class="w-16 text-sm font-bold text-gray-600">${
                    statNames[stat.stat.name]
                  }</span>
                  <div class="w-full bg-gray-200 rounded-full h-4">
                    <div class="stat-bar-fill h-4 rounded-full text-xs text-right text-white pr-1" style="width: ${
                      Math.min(stat.base_stat, 150) / 1.5
                    }%; background-color: ${cardColor};">${stat.base_stat}</div>
                  </div>
                </div>
              `
                )
                .join("")}
            </div>
            ${
              sound
                ? `<audio src="${sound}" controls class="w-full h-10"></audio>`
                : ""
            }
          </div>
        `;
      }

      pokeBtn.addEventListener("click", () => getPokemon(pokeIdInput.value));
      pokeIdInput.addEventListener(
        "keypress",
        (e) => e.key === "Enter" && getPokemon(pokeIdInput.value)
      );

      document.addEventListener("DOMContentLoaded", () => {
        const rawRecentPoke = localStorage.getItem("recent");
        if (rawRecentPoke) {
          const poke = JSON.parse(rawRecentPoke);
          pokeIdInput.value = poke.id;
          getPokemon(poke.id);
        } else {
          getPokemon(); // 초기 메시지 표시
        }
      });
    </script>
  </body>
</html>
